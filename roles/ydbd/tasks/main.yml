---
# ydbd binaries installation

- name: Create the YDB release directory
  file:
    state: directory
    path: "{{ ydb_dir }}/release"
    group: bin
    owner: root
    mode: '0755'

- name: Create the YDB server binary directory
  file:
    state: directory
    path: "{{ ydb_dir }}/release/{{ ydb_version }}"
    group: bin
    owner: root
    mode: '0755'

- name: Install the YDB server binary package
  ansible.builtin.unarchive:
    creates: "{{ ydb_dir }}/release/{{ ydb_version }}/bin/ydbd"
    dest: "{{ ydb_dir }}/release/{{ ydb_version }}"
    group: bin
    owner: root
    src: "{{ ydb_archive }}"
    extra_opts: "{{ ydb_unpack_options }}"

- name: Ensure permissions for the YDB server binary directory
  file:
    state: directory
    path: "{{ ydb_dir }}/release/{{ ydb_version }}"
    group: bin
    owner: root
    mode: '0755'

- name: Symlink the YDB binaries
  file:
    path: "{{ ydb_dir }}/bin"
    src: "./release/{{ ydb_version }}/bin"
    state: link
    group: bin
    owner: root
    mode: '0755'
    force: yes

- name: Symlink the YDB libraries
  file:
    path: "{{ ydb_dir }}/lib"
    src: "./release/{{ ydb_version }}/lib"
    state: link
    group: bin
    owner: root
    mode: '0755'
    force: yes
