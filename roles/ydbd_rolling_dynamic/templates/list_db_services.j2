#! /bin/sh
# List the services for the particular YDB database on the current host.

set +e
set +u

DB_NAME="$1"

(cd /etc/systemd/system && ls ydbd-${DB_NAME}-*.service) | while read sn; do
  NM=`basename $sn .service`
  DB=`echo $sn | sed -n 's|ydbd-\([a-zA-Z][a-zA-Z0-9]*\)-.*|\1|p'`
  STATE=`systemctl show -pUnitFileState $sn | grep enabled`
  PORT=`systemctl show -pExecStart $sn | sed -n 's|.*grpcs-port \([0-9][0-9]*\).*|\1|p'`
  if [ ! -z "$STATE" ]; then
    echo ${NM} ${PORT} ${DB}
  fi
done

# End Of File
