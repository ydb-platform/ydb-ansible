---
# ydb database creation

- name: YDB database creation
  block:
    - name: Add the database creation script
      template:
        src: create_database.j2
        dest: "{{ ydb_dir }}/home/create_database.sh"
        group: ydb
        owner: ydb
        mode: '0755'
    - name: Transfer the secrets
      copy:
        src: secret
        dest: "{{ ydb_dir }}/certs/secret"
        group: ydb
        owner: ydb
        mode: '0700'
    - name: "Create the database {{ ydb_dbname }} on {{ ydb_pool_kind }}:{{ ydb_default_groups }}"
      command: "{{ ydb_dir }}/home/create_database.sh {{ inventory_hostname }} {{ ydb_dbname }} {{ ydb_pool_kind }} {{ ydb_default_groups }}"
      become: true
      become_user: ydb
    - name: Cleanup the transferred secrets
      file: state=absent path={{ ydb_dir }}/certs/secret
  run_once: true
